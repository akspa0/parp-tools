<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:primitives="clr-namespace:Avalonia.Controls.Primitives;assembly=Avalonia.Controls"
        x:Class="WoWRollback.Gui.MainWindow"
        Width="1280" MinWidth="1000" Height="700"
        Title="WoWRollback GUI">
  <DockPanel>
    <Grid DockPanel.Dock="Top" Margin="8" >
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <!-- Cache row -->
      <TextBlock Grid.Row="0" Grid.Column="0" Text="Cache:" VerticalAlignment="Center"/>
      <TextBox Grid.Row="0" Grid.Column="1" x:Name="CacheBox" HorizontalAlignment="Stretch" ToolTip.Tip="Cache: per-map analysis outputs (tile_layers.csv, layers.json). Produced by prepare-layers."/>
      <Button Grid.Row="0" Grid.Column="2" x:Name="RescanBtn" Content="Rescan" MinWidth="90" Margin="6,0,0,0"/>
      <Button Grid.Row="0" Grid.Column="3" x:Name="OpenCacheBtn" Content="Open Cache Folder" MinWidth="150" Margin="6,0,0,0"/>

      <!-- Presets row -->
      <TextBlock Grid.Row="1" Grid.Column="0" Text="Presets:" VerticalAlignment="Center"/>
      <TextBox Grid.Row="1" Grid.Column="1" x:Name="PresetsBox" HorizontalAlignment="Stretch" ToolTip.Tip="Presets: where the GUI saves/loads selection JSON that spans ALL maps."/>
      <TextBox Grid.Row="1" Grid.Column="2" x:Name="PresetNameBox" Width="220" Watermark="Preset name" Margin="6,0,0,0"/>
      <Button Grid.Row="1" Grid.Column="3" x:Name="SavePresetBtn" Content="Save" MinWidth="80" Margin="6,0,0,0"/>
      <Button Grid.Row="1" Grid.Column="4" x:Name="LoadPresetBtn" Content="Load" MinWidth="80" Margin="6,0,0,0"/>
      <Button Grid.Row="1" Grid.Column="5" x:Name="OpenPresetsBtn" Content="Open Presets Folder" MinWidth="170" Margin="6,0,0,0"/>
    </Grid>

    <DataGrid x:Name="MapsGrid" Margin="8" AutoGenerateColumns="False" IsReadOnly="True">
      <DataGrid.Columns>
        <DataGridTextColumn Header="Map" Binding="{Binding Map}" Width="*"/>
        <DataGridTextColumn Header="tile_layers.csv" Binding="{Binding HasTileLayers}" Width="120"/>
        <DataGridTextColumn Header="layers.json" Binding="{Binding HasLayersJson}" Width="120"/>
        <DataGridTextColumn Header="Rows" Binding="{Binding TileLayerRows}" Width="80"/>
        <DataGridTextColumn Header="Path" Binding="{Binding Path}" Width="2*"/>
      </DataGrid.Columns>
    </DataGrid>

    <TabControl Margin="8">
      <TabItem Header="Layers">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <!-- Selection row -->
          <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8">
            <TextBlock Text="Map:" VerticalAlignment="Center"/>
            <ComboBox x:Name="LayersMapCombo" Width="220"/>
            <TextBlock Text="Tile:" VerticalAlignment="Center"/>
            <ComboBox x:Name="TileSelectBox" Width="120"/>
            <CheckBox x:Name="HeatmapToggle" Content="Heatmap" VerticalAlignment="Center"/>
          </StackPanel>

          <!-- Body -->
          <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left visuals: Tile grid + Minimap preview -->
            <StackPanel Grid.Column="0" Margin="0,8,12,0" Spacing="8">
              <!-- Compact 64x64 tile grid -->
              <Border BorderBrush="#444" BorderThickness="1" Padding="4">
                <ScrollViewer Width="540" Height="540">
                  <primitives:UniformGrid x:Name="TileGridPanel" Rows="64" Columns="64" Width="512" Height="512"/>
                </ScrollViewer>
              </Border>
              <!-- Selected tile minimap preview -->
              <Border BorderBrush="#444" BorderThickness="1" Padding="4">
                <Image x:Name="MinimapImage" Width="256" Height="256" Stretch="Uniform"/>
              </Border>
            </StackPanel>

            <!-- Layers panel -->
            <StackPanel Grid.Column="1" Margin="0,8,0,0" Spacing="8">
              <TextBlock x:Name="LayersHeader" Text="Perâ€‘Tile Layers" FontWeight="Bold"/>
              <ScrollViewer Height="260">
                <StackPanel x:Name="TileLayersList"/>
              </ScrollViewer>
              <WrapPanel>
                <TextBox x:Name="AddRangeMinBox" Width="120" Watermark="Min UniqueID" Margin="0,0,6,6"/>
                <TextBox x:Name="AddRangeMaxBox" Width="120" Watermark="Max UniqueID" Margin="0,0,6,6"/>
                <ComboBox x:Name="AddRangeTypeBox" Width="100" Margin="0,0,6,6">
                  <ComboBoxItem Content="M2"/>
                  <ComboBoxItem Content="WMO"/>
                </ComboBox>
                <Button x:Name="AddRangeBtn" Content="Add Tile Range" Margin="0,0,6,6"/>
                <Button x:Name="ClearTileCustomBtn" Content="Clear Tile Custom" Margin="0,0,0,6"/>
              </WrapPanel>
              <TextBlock Text="Custom Ranges" FontWeight="Bold"/>
              <StackPanel x:Name="TileCustomList"/>
            </StackPanel>
          </Grid>
        </Grid>
      </TabItem>
      <TabItem Header="Build">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <!-- Output path row -->
          <Grid Grid.Row="0" Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="Output:" VerticalAlignment="Center"/>
            <TextBox Grid.Column="1" x:Name="BuildOutBox" Watermark="Output folder for LK files"/>
            <Button Grid.Column="2" x:Name="PickBuildOutBtn" Content="Browse" Margin="6,0,0,0" MinWidth="90"/>
          </Grid>

          <!-- Actions row -->
          <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8">
            <Button x:Name="SaveSelectionPresetBtn" Content="Save Selection Preset"/>
            <Button x:Name="PrepareBtn" Content="Prepare Layers"/>
            <Button x:Name="GenBaselineBtn" Content="Generate Baseline"/>
            <Button x:Name="BuildBtn" Content="Build Selected" IsEnabled="False"/>
            <Button x:Name="OpenOutBtn" Content="Open Output"/>
          </StackPanel>

          <!-- Log -->
          <Border Grid.Row="2" BorderBrush="#444" BorderThickness="1" Padding="4" Margin="0,8,0,0">
            <ScrollViewer>
              <TextBox x:Name="BuildLogBox" AcceptsReturn="True" IsReadOnly="True" TextWrapping="Wrap"/>
            </ScrollViewer>
          </Border>
        </Grid>
      </TabItem>
      <TabItem Header="Filters">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>
          <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8">
            <Button x:Name="AnalyzeFiltersBtn" Content="Analyze"/>
            <Button x:Name="WhitelistBtn" Content="Whitelist Selected"/>
            <Button x:Name="BlacklistBtn" Content="Blacklist Selected"/>
            <Button x:Name="ClearFilterSelBtn" Content="Clear Selection"/>
            <Button x:Name="SaveFiltersBtn" Content="Save Filters to Preset"/>
          </StackPanel>
          <Border Grid.Row="1" BorderBrush="#444" BorderThickness="1" Padding="4" Margin="0,8,0,0">
            <ListBox x:Name="FiltersList" SelectionMode="Multiple"/>
          </Border>
        </Grid>
      </TabItem>
    </TabControl>
  </DockPanel>
</Window>
