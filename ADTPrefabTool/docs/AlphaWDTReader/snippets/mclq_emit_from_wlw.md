# Emitting MCLQ from WLW (pre-3.x optional)

Goal: When `--output-adt-version pre3x --mclq-fill from-wlw`, generate legacy MCLQ blocks from WLW surface geometry.

## Inputs
- WLW-derived world-space triangles (see `3D_wlw2obj.py`).
- Tile/chunk bounds for the ADT.

## Output
- One MCLQ block per MCNK with:
  - Height map grid.
  - Liquid flags.
  - Required headers consistent with pre-3.x spec.

## Minimal Algorithm
1. Clip WLW triangles to each chunk AABB.
2. For each MCLQ grid cell:
   - If covered by any triangle, sample height at cell center from triangle plane(s).
   - Aggregate by median to resist outliers.
   - Mark water flag for covered cells.
3. Post-process:
   - Smooth tiny spikes (optional) under `--wlw-rescue-tri-threshold`.
   - Ensure header min/max and offsets are consistent.

## Constraints
- Mutually exclusive with MH2O emission.
- No WLQ/WLM dependence.
- Do not backfill missing chunks unless explicitly generated by coverage.

## Validation
- Use real tiles from `test_data/0.5.3`.
- Compare output MCLQ block structure and load in viewer to confirm expected liquids.
